---
import Layout from "@layouts/Layout.astro";
import { formatDate } from "@utils/dateformatter";
import { getAssetURL } from "@utils/getImage";
import { getSinglePost } from "src/lib/getPageData";

const { slug } = Astro.params;
const safeSlug = typeof slug === "string" ? slug : "";
const post = await getSinglePost("blogs", safeSlug);

if (!post) {
  throw new Error(`Blog not found for slug: ${slug}`);
}

const heroImage = getAssetURL(post?.blog_image) || "";

// grab SEO info
const pageData = post.seo || {};
---

<Layout
  title={pageData?.title || post.title}
  description={pageData?.meta_description}
  ogImage={pageData?.og_image}
  pageUrl={`/blog/${slug}`}
>
  <div
    class="relative flex items-end bg-cover bg-center text-white"
    style={`background-image: linear-gradient(rgba(8,8,8,0.45), rgba(8,8,8,0.45)), url('${heroImage}')`}
    role="banner"
  >
    <div class="custom-container w-full py-24">
      <div class="max-w-3xl">
        <p class="text-sm text-primary/90 uppercase tracking-wide mb-2">Blog</p>
        <h1
          class="text-3xl sm:text-4xl md:text-5xl font-extrabold leading-tight"
        >
          {post.title}
        </h1>
        <div class="mt-4 flex items-center gap-4 text-gray-200">
          <time datetime={post.publication_date} class="text-sm">
            {formatDate(post.publication_date)}
          </time>
        </div>
      </div>
    </div>
  </div>
  <div class="custom-container py-16">
    <div
      class="prose prose-headings:text-primary !max-w-5xl mx-auto prose-headings:font-semibold prose-a:text-primary pt-8 md:pb-12 pb-6"
    >
      <div set:html={post.content} />
    </div>
  </div>
</Layout>
