---
import ImageMod from "@components/ui/ImageMod.astro";
import { getAssetURL } from "@utils/getImage";
import { getNavbar, getGlobal } from "src/lib/getPageData";

const { pageUrl } = Astro.props;
const nav = await getNavbar();
const global = await getGlobal();
---

<header
  class="relative z-[990000] shadow-md transition-all duration-300"
  id="navbar"
>
  <div class="flex custom-container justify-between items-center py-4">
    <!-- Left Side -->
    <div class="flex items-center space-x-4">
      <!-- Mobile menu button -->
      {
        nav?.menu?.length > 0 && (
          <button class="lg:hidden text-black text-3xl" id="menuBtn">
            ☰
          </button>
        )
      }

      <!-- Logo + tagline -->
      <div class="flex flex-col">
        <a
          href="/"
          class="text-xl font-bold text-gray-800 flex items-center gap-2"
        >
          <img
            src={getAssetURL(global.logo)}
            alt="Logo"
            class="max-w-32"
            loading="eager"
          />
        </a>
        {
          nav?.logo_tagline && (
            <span class="text-sm text-gray-600">{nav.logo_tagline}</span>
          )
        }
      </div>
    </div>

    <!-- Desktop Navigation -->
    <nav class="hidden lg:flex space-x-8" id="navItems">
      {
        nav?.menu.map((item) => (
          <a
            href={item.link}
            class="text-black underline-text font-medium hover:text-primary"
          >
            {item.title}
          </a>
        ))
      }
    </nav>

    <!-- Phone CTA -->
    {
      global?.phone_number && (
        <div class="flex">
          <a
            href={`tel:${global.phone_number}`}
            class="text-black font-medium hover:text-primary flex items-center gap-2 duration-150"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              fill="none"
              class="flex"
            >
              <path
                d="M5.31726 1.28657C5.88395 1.40369 6.33524 1.78443 6.61564 2.28746L7.50885 3.88991..."
                fill="#000000"
              />
            </svg>
            <span class="md:block hidden">{global.phone_number}</span>
          </a>
        </div>
      )
    }
  </div>
</header>

<!-- Mobile Menu -->
<div
  class="lg:hidden fixed top-0 right-0 w-full h-full bg-gray-900/70 z-[990000] hidden transition-all duration-300"
  id="mobileMenu"
>
  <div
    class="bg-white ml-auto w-72 h-full p-4 shadow-lg overflow-y-auto duration-300"
  >
    <button class="absolute top-4 right-4 text-black text-2xl" id="closeMenu"
      >✕</button
    >
    <nav class="mt-12 border-b border-black/20 divide-y divide-black/20">
      {
        nav?.menu.map((item) => (
          <a href={item.link} class="block py-2 text-black hover:bg-gray-100">
            {item.title}
          </a>
        ))
      }
    </nav>
  </div>
</div>

<style>
  .underline-text {
    display: inline-block;
    padding-bottom: 2px;
    background-image: linear-gradient(
      var(--color-primary),
      var(--color-primary)
    );
    background-position: 0 100%;
    background-size: 0% 2px;
    background-repeat: no-repeat;
    transition:
      background-size 0.3s,
      background-position 0s 0.3s;
  }
  .underline-text:hover {
    background-position: 100% 100%;
    background-size: 100% 2px;
  }
</style>

<script>
  function init() {
    const menuBtn = document.getElementById("menuBtn");
    const closeMenu = document.getElementById("closeMenu");
    const mobileMenu = document.getElementById("mobileMenu");

    menuBtn?.addEventListener("click", () => {
      mobileMenu?.classList.remove("hidden");
      document.body.style.overflow = "hidden";
    });

    closeMenu?.addEventListener("click", () => {
      mobileMenu?.classList.add("hidden");
      document.body.style.overflow = "";
    });
  }

  init();
  document.addEventListener("astro:after-swap", init);
</script>
